<nav class="navbar navbar-expand-lg">
  <div class="container">

    <a [href]="legacyRoutes.HOME" class="navbar-brand">
      <img alt="AstroBin" src="assets/images/nav-logo.png"/>
    </a>

    <button (click)="isCollapsed = !isCollapsed" [attr.aria-expanded]="!isCollapsed" aria-controls="navbarSupportedContent" aria-label="Toggle navigation"
            class="navbar-toggler" data-target="#navbarSupportedContent" data-toggle="collapse"
            type="button">
      <fa-icon icon="bars"></fa-icon>
    </button>

    <div [ngbCollapse]="isCollapsed" class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto mt-2 mt-lg-0">

        <!-- Moderate menu -->
        <ng-container *ngIf="(appContext$ | async)?.currentUserProfile as profile">
          <li *ngIf="profile | isContentModerator" class="nav-item">
            <div class="d-inline-block" ngbDropdown>
              <button class="btn btn-link" id="moderateDropdown" ngbDropdownToggle translate>Moderate</button>
              <div aria-labelledby="moderateDropdown" ngbDropdownMenu>

                <h6 class="dropdown-header" translate>Images</h6>

                <a *ngIf="profile | isImageModerator" [href]="legacyRoutes.MODERATE_IMAGE_QUEUE"
                   class="dropdown-item">
                  <fa-icon icon="images"></fa-icon>
                  {{ "Image queue" | translate }}
                </a>

                <a *ngIf="(profile | isImageModerator) && (profile | isSuperuser)"
                   [href]="legacyRoutes.MODERATE_SPAM_QUEUE"
                   class="dropdown-item">
                  <fa-icon icon="flag"></fa-icon>
                  {{ "Spam queue" | translate }}
                </a>

                <ng-container *ngIf="profile | isIotdStaff">
                  <div class="dropdown-divider"></div>
                  <h6 class="dropdown-header" translate>Image of the day</h6>

                  <a *ngIf="profile | isIotdSubmitter" [href]="legacyRoutes.IOTD_SUBMISSION_QUEUE"
                     class="dropdown-item">
                    <fa-icon icon="upload"></fa-icon>
                    {{ "Submission queue" | translate }}
                  </a>

                  <a *ngIf="profile | isIotdReviewer" [href]="legacyRoutes.IOTD_REVIEW_QUEUE"
                     class="dropdown-item">
                    <fa-icon icon="star"></fa-icon>
                    {{ "Review queue" | translate }}
                  </a>

                  <a *ngIf="profile | isIotdJudge" [href]="legacyRoutes.IOTD_JUDGEMENT_QUEUE"
                     class="dropdown-item">
                    <fa-icon icon="hammer"></fa-icon>
                    {{ "Judgement queue" | translate }}
                  </a>
                </ng-container>

              </div>
            </div>
          </li>
        </ng-container>
        <!-- ./Moderate menu -->

        <!-- Forum menu -->
        <li class="nav-item">
          <div class="d-inline-block" ngbDropdown>
            <button class="btn btn-link" id="forumDropdown" ngbDropdownToggle translate>Forum</button>
            <div aria-labelledby="forumDropdown" ngbDropdownMenu>

              <a [href]="legacyRoutes.FORUM_HOME" class="dropdown-item">
                <fa-icon icon="comments"></fa-icon>
                {{ "Home" | translate }}
              </a>

              <a [href]="legacyRoutes.FORUM_LATEST" class="dropdown-item">
                <fa-icon icon="sort-amount-down"></fa-icon>
                {{ "Latest topics" | translate }}
              </a>

              <a [href]="legacyRoutes.FORUM_SUBSCRIBED" class="dropdown-item">
                <fa-icon icon="eye"></fa-icon>
                {{ "Subscribed topics" | translate }}
              </a>

            </div>
          </div>
        </li>
        <!-- ./Forum menu -->

        <!-- Explore menu -->
        <li class="nav-item">
          <div class="d-inline-block" ngbDropdown>
            <button class="btn btn-link" id="exploreDropdown" ngbDropdownToggle translate>Explore</button>
            <div aria-labelledby="exploreDropdown" ngbDropdownMenu>

              <a [href]="legacyRoutes.SEARCH" class="dropdown-item">
                <fa-icon icon="search"></fa-icon>
                {{ "The Big Wall / Advanced search" | translate }}
              </a>

              <div class="dropdown-divider"></div>

              <a [href]="legacyRoutes.TOP_PICKS" class="dropdown-item">
                <fa-icon icon="star"></fa-icon>
                {{ "Top Picks" | translate }}
              </a>

              <a [href]="legacyRoutes.IOTD" class="dropdown-item">
                <fa-icon icon="trophy"></fa-icon>
                {{ "Image of the day" | translate }}
              </a>

              <div class="dropdown-divider"></div>

              <a [href]="legacyRoutes.GROUPS" class="dropdown-item">
                <fa-icon icon="users"></fa-icon>
                {{ "Groups" | translate }}
              </a>

              <a [href]="legacyRoutes.RAWDATA_PUBLIC_DATA_POOLS" class="dropdown-item">
                <fa-icon icon="book"></fa-icon>
                {{ "Public data pools" | translate }}
              </a>

              <div class="dropdown-divider"></div>

              <a [href]="legacyRoutes.TRENDING_ASTROPHOTOGRAPHERS" class="dropdown-item">
                <fa-icon icon="list-ol"></fa-icon>
                {{ "Trending astrophotographers" | translate }}
              </a>

            </div>
          </div>
        </li>
        <!-- ./Explore menu -->

        <!-- Help menu -->
        <li class="nav-item">
          <div class="d-inline-block" ngbDropdown>
            <button class="btn btn-link" id="helpDropdown" ngbDropdownToggle translate>Help</button>
            <div aria-labelledby="helpDropdown" ngbDropdownMenu>

              <a [href]="legacyRoutes.HELP" class="dropdown-item">
                <fa-icon icon="info"></fa-icon>
                {{ "What is this site?" | translate }}
              </a>

              <div class="dropdown-divider"></div>

              <a [href]="legacyRoutes.FAQ" class="dropdown-item">
                <fa-icon icon="question"></fa-icon>
                {{ "FAQ" | translate }}
              </a>

              <a [href]="legacyRoutes.RAWDATA_HELP" class="dropdown-item">
                <fa-icon icon="book"></fa-icon>
                {{ "AstroBin Raw Data" | translate }}
              </a>

              <div class="dropdown-divider"></div>

              <a [href]="legacyRoutes.HELP_API" class="dropdown-item">
                <fa-icon icon="key"></fa-icon>
                {{ "API (beta)" | translate }}
              </a>

              <a [href]="legacyRoutes.CONTACT" class="dropdown-item">
                <fa-icon icon="envelope"></fa-icon>
                {{ "Contact" | translate }}
              </a>

            </div>
          </div>
        </li>
        <!-- ./Help menu -->

        <!-- Quick search form -->
        <li class="nav-item quick-search">
          <form [action]="legacyRoutes.SEARCH" method="get">
            <input name="q" placeholder="{{ 'Quick search' | translate }}" type="text"/>
          </form>
        </li>
        <!-- ./Quick search form -->

      </ul>

      <ul *ngIf="!(appContext$ | async)?.currentUserProfile.userObject" class="navbar-nav">
        <li class="nav-item">
          <a href="#" class="nav-link" (click)="openLoginModal($event)" translate>Login</a>
        </li>
        <li class="nav-item"><a [href]="legacyRoutes.REGISTER" class="nav-link" translate>Register</a></li>
      </ul>

      <ul *ngIf="(appContext$ | async)?.currentUserProfile.userObject" class="navbar-nav">
        <!-- Language selector -->
        <li class="nav-item d-none d-lg-block">
          <div class="d-inline-block" ngbDropdown>
            <button class="btn btn-link no-triangle" id="languageDropdown" ngbDropdownToggle>
              <fa-icon icon="globe"></fa-icon>
            </button>
            <div aria-labelledby="languageDropdown" ngbDropdownMenu>
              <a *ngFor="let flag of flags" [href]="legacyRoutes.SET_LANGUAGE(flag.languageCode)" class="dropdown-item">
                <img class="flag flag-{{ flag.countryCode }}"
                     height="16" src="/assets/flags/blank.gif"
                     width="16"/>
                {{ flag.label }}
              </a>

              <div class="dropdown-divider"></div>

              <a class="dropdown-item" href="https://translate.astrobin.com/projects" target="_blank">
                <fa-icon icon="tasks"></fa-icon>
                {{ "Help with translations!" | translate }}
              </a>
            </div>
          </div>
        </li>
        <!-- ./Language selector -->

        <!-- User menu -->
        <li class="nav-item" *ngIf="(appContext$ | async)?.currentUserProfile as profile">
          <div class="d-inline-block" ngbDropdown>
            <button class="btn btn-primary user-dropdown-toggle" id="userDropdown" ngbDropdownToggle>
              {{ profile.userObject.username }}
              <span class="scores">
                <span
                  *ngIf="!profile.exclude_from_competitions"
                  class="score"
                  ngbTooltip="{{ 'AstroBin index' | translate }}"
                  placement="bottom">
                   {{ profile.astrobin_index }} &bull;
                </span>
                <span
                  class="score"
                  ngbTooltip="{{ 'Followers' | translate }}"
                  placement="bottom">
                   {{ profile.followers }}
                </span>
              </span>
            </button>

            <div aria-labelledby="userDropdown" ngbDropdownMenu>

              <a [href]="legacyRoutes.SUBSCRIPTIONS" class="dropdown-item">
                <fa-icon icon="asterisk"></fa-icon>
                {{ "Subscription plans" | translate }}
              </a>

              <a [href]="legacyRoutes.UPLOAD" class="dropdown-item">
                <fa-icon icon="upload"></fa-icon>
                {{ "Upload" | translate }}
              </a>

              <div class="dropdown-divider"></div>
              <h6 class="dropdown-header" translate>My places</h6>

              <a *ngIf="profile | isProducer"
                 [href]="legacyRoutes.COMMERCIAL_PRODUCTS(profile)" class="dropdown-item">
                <fa-icon icon="barcode"></fa-icon>
                {{ "Commercial products" | translate }}
              </a>

              <a
                [href]="legacyRoutes.GALLERY(profile)" class="dropdown-item">
                <fa-icon icon="image"></fa-icon>
                {{ "Gallery" | translate }}
              </a>

              <a
                [href]="legacyRoutes.BOOKMARKS(profile)" class="dropdown-item">
                <fa-icon icon="bookmark"></fa-icon>
                {{ "Bookmarks" | translate }}
              </a>

              <a
                [href]="legacyRoutes.PLOTS(profile)" class="dropdown-item">
                <fa-icon icon="chart-bar"></fa-icon>
                {{ "Plots" | translate }}
              </a>

              <div class="dropdown-divider"></div>
              <h6 class="dropdown-header" translate>Raw data</h6>

              <a
                *ngIf="usersService.hasValidRawDataSubscription(profile)"
                [href]="legacyRoutes.RAWDATA" class="dropdown-item">
                <fa-icon icon="book"></fa-icon>
                {{ "Raw data library" | translate }}
              </a>

              <a
                [href]="legacyRoutes.RAWDATA_PRIVATE_SHARED_FOLDERS" class="dropdown-item">
                <fa-icon icon="lock"></fa-icon>
                {{ "Private shared folders" | translate }}
              </a>

              <div class="dropdown-divider"></div>

              <a
                [href]="legacyRoutes.INBOX" class="dropdown-item">
                <fa-icon icon="inbox"></fa-icon>
                {{ "My messages" | translate }}
              </a>

              <a
                [href]="legacyRoutes.API_KEYS(profile)" class="dropdown-item">
                <fa-icon icon="key"></fa-icon>
                {{ "API Keys" | translate }}
              </a>

              <a
                [href]="legacyRoutes.SETTINGS" class="dropdown-item">
                <fa-icon icon="edit"></fa-icon>
                {{ "My settings" | translate }}
              </a>

              <div class="dropdown-divider"></div>

              <a
                href="" class="dropdown-item" (click)="logout($event)">
                <fa-icon icon="sign-out-alt"></fa-icon>
                {{ "Logout" | translate }}
              </a>

            </div>
          </div>
        </li>
        <!-- ./User menu -->

        <!-- Upload button -->
        <li class="nav-item d-none d-lg-block">
          <a [href]="legacyRoutes.UPLOAD" class="btn btn-link nav-link">
            <fa-icon icon="upload"></fa-icon>
          </a>
        </li>
        <!-- ./Upload button -->

      </ul>
    </div>

  </div> <!-- ./container -->
</nav>
